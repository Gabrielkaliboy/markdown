---
title: thinkphp架构记录
date: 2017-12-25 11:19:40
categories: 后端
tags: [php]
---
<Excerpt in index | 首页摘要> 

thinkphp架构记录

<!-- more -->
<The rest of contents | 余下全文>

-----

### 入口文件
public-->index.php,控制器在application下面的index文件夹-->controller文件夹，这里面都是控制器，这也是默认的控制器；与controller同级目录新建view文件夹，view里面是视图层，

### application-->index目录
    - controller文件夹:这里放的都是控制器
        - index.php
    - view  文件夹：默认的视图文件夹
        - index目录：根据控制器的名称创建的目录,这里面放的就是一个个模板文件t他与index在控制器中的方法是一一对应的。并且默认情况下，模板文件的名称和控制器中方法的名称也是一样的
            - index.html：这个文件对应的就是index.php中index方法所渲染的模板,viwe()是注入函数，直接获取index.html的文件
            ```php
            class Index
            {
                public function index()
                {
                    return view();
                }
            }
            ```


### thinkphp 目录
- library目录
    - think目录
        - 试图类文件View.php文件:在这个文件里面定义了一些常量
            - __STATIC__:当前项目，项目入口(public)下面的static,把css,js等静态文件放在这个目录下面。html里面引入的时候，直接写这个就可以
            ```php
                    $baseReplace = [
            '__ROOT__'   => $root,
            '__URL__'    => $base . '/' . $request->module() . '/' . Loader::parseName($request->controller()),
            '__STATIC__' => $root . '/static',
            '__CSS__'    => $root . '/static/css',
            '__JS__'     => $root . '/static/js',
            ];
            ```

### 模板文件的分离和公共文件的导入

#### index控制器
application->index->controller->index.php
原始文件:没有继承基类controller
```php
<?php
namespace app\index\controller;

class Index
{
    public function index()
    {
        return view();
    }
}

```

继承基类controller:可以直接使用在基类controller里面定义的属性和方法
```php
<?php
namespace app\index\controller;
use think\Controller;
//使用extends关键字来实现继承
class Index extends Controller
{
    public function index()
    {
        return view();
    }
}
```

不推荐使用view()这个注入函数，他是可以被用户自定义的，这里我们修改成
```php
<?php
namespace app\index\controller;
use think\Controller;
//使用extends关键字来实现继承
class Index extends Controller
{
    public function index()
    {
        //$this指的是当前的控制器
        return $this -> fetch();
    }
}
```
更直观的写法
```php
<?php
namespace app\index\controller;
use think\Controller;
//使用extends关键字来实现继承
class Index extends Controller
{
    public function index()
    {
        //$this指的是当前的控制器
        return $this -> fetch();
    }
}
```
通常继承基类的controller我们并不按照上面的写法写,更直观的方式是下面，$this指的是当前的控制器，当前控制器中有一个属性叫view,他保存的是一个视图对象，fetch是试图类的一个方法
```php
<?php
namespace app\index\controller;
use think\Controller;
//使用extends关键字来实现继承
class Index extends Controller
{
    public function index()
    {
        //$this指的是当前的控制器
        return $this -> view -> fetch();
    }
}
```

application->index->controller->base.php

```php
<?php
namespace app\index\controller;
use think\Controller
class Base extends Controller
{
    
}

```


有的时候有些常量和公共操作需要被所有的控制器所调用,这时候仅仅通过控制器的自定义方法是做不到的,因为他不能对所有的控制器都有效,所以我们在框架提供的基类controller和用户自定义控制器之间创建一个中间层，叫base控制器,用它来定义一些方法或者系统常量



#### 公共文件分析
application->index->view->public文件夹：这里存放首页中，页面中的公共部分

application->index->view->public->meta.html
```html
<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="Bookmark" href="favicon.ico" >
    <link rel="Shortcut Icon" href="favicon.ico" />
    <!--[if lt IE 9]>
    <script type="text/javascript" src="__STATIC__/lib/html5.js"></script>
    <script type="text/javascript" src="__STATIC__/lib/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="__STATIC__/static/h-ui/css/H-ui.min.css" />
    <link rel="stylesheet" type="text/css" href="__STATIC__/static/h-ui.admin/css/H-ui.admin.css" />
    <link rel="stylesheet" type="text/css" href="__STATIC__/lib/Hui-iconfont/1.0.8/iconfont.css" />
    <link rel="stylesheet" type="text/css" href="__STATIC__/static/h-ui.admin/skin/default/skin.css" id="skin" />
    <link rel="stylesheet" type="text/css" href="__STATIC__/static/h-ui.admin/css/style.css" />
    <!--[if IE 6]>
    <script type="text/javascript" src="http://lib.h-ui.net/DD_belatedPNG_0.0.8a-min.js" ></script>
    <script>DD_belatedPNG.fix('*');</script>
    <![endif]-->
    <!--/meta 作为公共模版分离出去-->
```
此时application->index->view->index->index.html需要将这个meta里面的东西引入，引入方式是使用include,注意书写格式，没有空格    

```php
    {include file="public/meta" /}
```
注意：
- 是meta不是meta.html
- public前面没有空格  